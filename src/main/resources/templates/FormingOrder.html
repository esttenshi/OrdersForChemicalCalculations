<!DOCTYPE html>
<html style="font-size: 16px;" lang="ru">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>Формирование заказа</title>
    <link rel="stylesheet" href="css/nicepage.css" media="screen">
    <link rel="stylesheet" href="/css/FormingOrder.css" media="screen">
    <link rel="stylesheet" href="/css/cssmain.css" media="screen">
    <script class="u-script" type="text/javascript" src="/js/jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="/js/nicepage.js" defer=""></script>
    <script src="/js/jsmain.js" defer></script>
    <meta name="generator" content="Nicepage 7.1.0, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i">
    
    <script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "",
        "logo": "images/asu-logo.png"
    }</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Формирование заказа">
    <meta property="og:type" content="website">
</head>

<body data-path-to-root="./" data-include-products="false" class="u-body u-xl-mode" data-lang="ru">

<header class="u-clearfix u-header u-header" id="sec-b1a1">
    <div class="u-align-center u-border-2 u-border-grey-75 u-container-align-center u-container-style u-expanded-width u-grey-5 u-group u-group-1">
        <div class="u-container-layout u-container-layout-1">
            <p class="u-align-center u-text u-text-1" th:text="${user.login}">u</p>
            <a class="u-image u-logo u-image-1" data-image-width="170" data-image-height="170">
                <img src="/images/asu-logo.png" class="u-logo-image u-logo-image-1">
            </a>
            <a href="javascript:void(0);" onclick="openModal()" 
            class="u-active-none u-border-2 u-border-custom-color-3 u-border-hover-grey-75 u-border-no-left u-border-no-right u-border-no-top u-btn u-button-style u-hover-none u-none u-text-custom-color-3 u-btn-2">Редактировать личную информацию</a>
            <a href="#" onclick="event.preventDefault(); document.getElementById('logout-form').submit();" 
            class="u-active-none u-border-2 u-border-custom-color-3 u-border-hover-grey-75 u-border-no-left u-border-no-right u-border-no-top u-btn u-button-style u-hover-none u-none u-text-custom-color-3 u-btn-3">Выйти</a>
            <form id="logout-form" action="/logout" method="POST" style="display: none;"></form>
        </div>
    </div>
</header>

<form action="/orders/createOrder" method="post">
    <input type="hidden" name="userId" th:value="${user.id}"> 
    <input type="hidden" name="orderType" id="orderType" value="0">
    <section class="u-align-center u-clearfix u-container-align-center u-section-1" id="carousel_4dfa">
        <div class="u-clearfix u-sheet u-sheet-1">
            <h2 class="u-align-center u-custom-font u-font-montserrat u-text u-text-default u-text-1">Формирование заказа</h2>
            <div id="error-message" class="error-message" style="color: red; text-align: center; margin-top: 10px; position: absolute; left: 50%; transform: translateX(-50%); width: auto;"></div>
            <div id="carousel-1001" class="u-carousel u-expanded-width u-slider u-slider-1">
                <ol class="u-absolute-hcenter u-carousel-indicators u-carousel-indicators-1">
                    <li data-u-target="#carousel-1001" class="u-active u-grey-30 u-shape-circle" data-u-slide-to="0" style="height: 10px; width: 10px;"></li>
                    <li data-u-target="#carousel-1001" class="u-grey-30 u-shape-circle" data-u-slide-to="1" style="height: 10px; width: 10px;"></li>
                    <li data-u-target="#carousel-1001" class="u-grey-30 u-shape-circle" data-u-slide-to="2" style="height: 10px; width: 10px;"></li>
                    <li data-u-target="#carousel-1001" class="u-grey-30 u-shape-circle" data-u-slide-to="3" style="height: 10px; width: 10px;"></li>
                </ol>
                <div class="u-carousel-inner" role="listbox">
                    <div id="first-slide-container" class="u-active u-align-left u-carousel-item u-container-align-left u-container-style u-slide">
                        <div class="u-container-layout u-container-layout-1">
                            <p class="u-text u-text-2" style="padding-left: 10px;">Выберите тип заказа</p>
                            <p class="u-text u-text-3" style="padding-left: 20px;">*Расчет синтеза двух молекулярных систем​ - проведение исследования взаимодействия двух молекулярных систем<br>** Создание 3D модели сложной молекулярной системы - Создание трехмерной модели сложной молекулярной структуры (без проведения исследования)</p>
                            <ul class="u-custom-list u-text u-text-4">
                                <li>
                                    <input type="checkbox" id="type1" class="order-type" onclick="selectOrderType(this, 'type2')" />
                                    <label for="type1" style="font-size: 20px; display: inline-block; margin-left: 5px;">Расчет синтеза двух молекулярных систем</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="type2" class="order-type" onclick="selectOrderType(this, 'type1')" />
                                    <label for="type2" style="font-size: 20px; display: inline-block; margin-left: 5px;">Создание 3D модели сложной молекулярной системы</label>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="u-carousel-item u-container-style u-expanded-width-xl u-slide" id="molecular-systems-container" style="visibility: hidden;">
                        <div class="u-container-layout u-container-layout-2">
                            <p class="u-align-center u-text u-text-5">Выберите молекулярные системы:</p>
                            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                                <select name="molecularSystem1" class="u-input u-input-1" style="width: 270px;" onchange="checkMolecularSystems(this, 'molecularSystem2')">
                                    <option value="">Выберите первую молекулярную систему</option>
                                    <th:block th:each="system : ${molecularSystems}">
                                        <option th:value="${system.name}" th:text="${system.name}"></option>
                                    </th:block>
                                </select>
                                <select name="molecularSystem2" class="u-input u-input-2" style="width: 270px;" onchange="checkMolecularSystems(this, 'molecularSystem1')">
                                    <option value="">Выберите вторую молекулярную систему</option>
                                    <th:block th:each="system : ${molecularSystems}">
                                        <option th:value="${system.name}" th:text="${system.name}"></option>
                                    </th:block>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="u-carousel-item u-container-style u-slide" id="3d-model-container" style="visibility: hidden;">
                        <div class="u-container-layout u-container-layout-2">
                            <p class="u-align-center u-text u-text-5">Выберите сложную молекулярную систему:</p>
                            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                                <select name="molecularSystem1" id="molecularSystem1" class="u-input u-input-1" style="width: 300px;" onchange="checkComplexMolecularSystems(this)">
                                    <option value="">Выберите сложную молекулярную систему</option>
                                    <th:block th:each="complexSystem : ${complexMolecularSystems}">
                                        <option th:value="${complexSystem.name}" th:text="${complexSystem.name}"></option>
                                    </th:block>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="u-carousel-item u-container-style u-slide"> 
                        <div id="wish" class="u-container-layout u-valign-top u-container-layout-3" style="visibility: visible;"> 
                            <p class="u-align-center u-text u-text-6" style="font-size: 24px;">Напишите пожелания к выполнению заказа, если они у вас есть! Или сразу нажмите кнопку "Отправить"</p> 
                            <div class="custom-expanded u-align-left u-border-3 u-border-grey-40 u-container-align-left u-container-style u-group u-group-1">
                                <textarea name="wishes" placeholder="Ваши пожелания..." style="width: 1100px;"></textarea>
                            </div> 
                            <button type="button" onclick="submitOrder()" 
        class="u-align-center u-btn u-btn-round u-button-style u-color-scheme-summer-time u-custom-color-1 u-radius-50 u-btn-1">О Т П Р А В И Т Ь</button>
                        </div> 
                    </div>
                </div>
                <a class="u-absolute-vcenter u-black u-carousel-control u-carousel-control-prev u-shape-circle u-spacing-10 u-text-body-alt-color u-carousel-control-1" 
                href="#carousel-1001" role="button" data-u-slide="prev" id="prevSlide" 
                disabled style="pointer-events: none; opacity: 0.5;">
                    <span aria-hidden="true">&#10094;</span> 
                </a>
                <a class="u-absolute-vcenter u-black u-carousel-control u-carousel-control-next u-shape-circle u-spacing-10 u-text-body-alt-color u-carousel-control-2" 
                href="#carousel-1001" role="button" data-u-slide="next" id="nextSlide" 
                onclick="return goToNextSlide()" 
                disabled style="pointer-events: none; opacity: 0.5;">
                    <span aria-hidden="true">&#10095;</span> 
                </a>
            </div>
        </div>
    </section>
</form>

<script>

    function disableButtons() {
        document.getElementById('nextSlide').disabled = true;
        document.getElementById('prevSlide').disabled = true;
        document.getElementById('nextSlide').style.pointerEvents = 'none';
        document.getElementById('nextSlide').style.opacity = '0.5'; 
        document.getElementById('prevSlide').style.pointerEvents = 'none';
        document.getElementById('prevSlide').style.opacity = '0.5'; 
    }

    
    function enableButtons() {
        document.getElementById('nextSlide').disabled = false;
        document.getElementById('prevSlide').disabled = false;
        document.getElementById('nextSlide').style.pointerEvents = 'auto';
        document.getElementById('nextSlide').style.opacity = '1'; 
        document.getElementById('prevSlide').style.pointerEvents = 'auto';
        document.getElementById('prevSlide').style.opacity = '1'; 
    }

    function checkMolecularSystems(selectedSelect, otherSelectName) {
        
        const otherSelect = document.getElementsByName(otherSelectName)[0];

        if (selectedSelect.value && otherSelect.value) {
            document.getElementById('nextSlide').disabled = false;       
            document.getElementById('nextSlide').style.pointerEvents = 'auto';
            document.getElementById('nextSlide').style.opacity = '1'; 
            document.getElementById('wish').style.visibility = 'visible'; 
        } else {
            document.getElementById('nextSlide').disabled = true;       
            document.getElementById('nextSlide').style.pointerEvents = 'none';
            document.getElementById('nextSlide').style.opacity = '0.5'; 
        }
    }

    function checkComplexMolecularSystems(selectedSelect1) {
        if (selectedSelect1.value) {
            document.getElementById('nextSlide').disabled = false;       
            document.getElementById('nextSlide').style.pointerEvents = 'auto';
            document.getElementById('nextSlide').style.opacity = '1'; 
            document.getElementById('wish').style.visibility = 'visible'; 
        } else {
            document.getElementById('nextSlide').disabled = true;       
            document.getElementById('nextSlide').style.pointerEvents = 'none';
            document.getElementById('nextSlide').style.opacity = '0.5'; 
        }
    }

    function selectOrderType(selectedCheckbox, otherCheckboxId) {
        const otherCheckbox = document.getElementById(otherCheckboxId);
        if (selectedCheckbox.checked) {
            otherCheckbox.checked = false; 
            document.getElementById('orderType').value = selectedCheckbox.id === 'type1' ? 1 : 2; 
            enableButtons();
            document.getElementById('prevSlide').disabled = true;
            document.getElementById('prevSlide').style.pointerEvents = 'none';
            document.getElementById('prevSlide').style.opacity = '0.5'; 
            const isSynthesisSelected = document.getElementById('type1').checked; 
            const is3DModelSelected = document.getElementById('type2').checked;
            if (isSynthesisSelected) { document.getElementById('molecular-systems-container').style.visibility = 'visible'; 
                document.getElementById('3d-model-container').remove(); 
            } else if (is3DModelSelected) { 
                document.getElementById('3d-model-container').style.visibility = 'visible'; 
                document.getElementById('molecular-systems-container').remove(); 
            } 
        }
    }

    function goToNextSlide() {     
        const activeSlide = document.querySelector('.u-active.u-carousel-item');
        const nextSlide = activeSlide.nextElementSibling;
        console.log(activeSlide.id);
        console.log(nextSlide.id);
        if (activeSlide.id === 'molecular-systems-container' || activeSlide.id === '3d-model-container') {
            activeSlide.classList.remove('u-active'); 

            const wishSlide = document.getElementById('wish');
            if (wishSlide) {
                wishSlide.classList.add('u-active');
            
            disableButtons();
            }
        }
        if (nextSlide) {
            activeSlide.classList.remove('u-active');
            nextSlide.classList.add('u-active');

            if (nextSlide.id === 'molecular-systems-container' || nextSlide.id === '3d-model-container') {
                disableButtons();
            } 
        }
            const errorMessageElement = document.getElementById('error-message'); 
        }

    function showError(message) {
        const errorMessageElement = document.getElementById('error-message');
        errorMessageElement.innerHTML = message;
    }
function submitOrder() {
    const userIdInput = document.querySelector('input[name="userId"]');
    const molecularSystem1Input = document.querySelector('select[name="molecularSystem1"]');
    const molecularSystem2Input = document.querySelector('select[name="molecularSystem2"]');
    const wishesInput = document.querySelector('textarea[name="wishes"]');

    // Проверка на наличие элементов и получение их значений
    const userId = userIdInput ? userIdInput.value : '';
    const molecularSystem1 = molecularSystem1Input ? molecularSystem1Input.value : '';
    const molecularSystem2 = molecularSystem2Input ? molecularSystem2Input.value : null; // Устанавливаем null, если элемент не найден
    const wishes = wishesInput ? wishesInput.value : '';

    // Проверка на обязательные поля
    if (!userId || !molecularSystem1) {
        showError("Пожалуйста, заполните все обязательные поля.");
        return;
    }

    // Создание формы для отправки
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/orders/createOrder';

    const userIdHiddenInput = document.createElement('input');
    userIdHiddenInput.type = 'hidden';
    userIdHiddenInput.name = 'userId';
    userIdHiddenInput.value = userId;
    form.appendChild(userIdHiddenInput);

    const molecularSystem1HiddenInput = document.createElement('input');
    molecularSystem1HiddenInput.type = 'hidden';
    molecularSystem1HiddenInput.name = 'molecularSystem1';
    molecularSystem1HiddenInput.value = molecularSystem1;
    form.appendChild(molecularSystem1HiddenInput);

    // Если вторая молекулярная система не выбрана, отправляем 'null'
    const molecularSystem2HiddenInput = document.createElement('input');
    molecularSystem2HiddenInput.type = 'hidden';
    molecularSystem2HiddenInput.name = 'molecularSystem2';
    molecularSystem2HiddenInput.value = molecularSystem2 || 'null'; // Если molecularSystem2 пустой, отправим 'null'
    form.appendChild(molecularSystem2HiddenInput);

    const wishesHiddenInput = document.createElement('input');
    wishesHiddenInput.type = 'hidden';
    wishesHiddenInput.name = 'wishes';
    wishesHiddenInput.value = wishes;
    form.appendChild(wishesHiddenInput);

    document.body.appendChild(form);
    form.submit(); 
}



    </script>

<footer class="u-align-center u-clearfix u-container-align-center u-footer u-grey-80 u-footer" id="sec-66d9">
    <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">Астраханский государственный университет им. В.Н. Татищева, Россия, Астрахань, ул. Татищева, 20А<br>Контакты: tarabanovskaya.es@mail.ru</p>
    </div>
</footer>

<div id="editInfoModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Редактировать личную информацию</h2>
        <form id="edit-info-form" action="/updateUser " method="POST">
            <label for="login">Логин:</label>
            <input type="text" id="login" name="login" th:value="${user.login}" placeholder="Введите новый логин" required>
            
            <label for="oldPassword">Старый пароль:</label>
            <input type="password" id="oldPassword" name="oldPassword" placeholder="Введите старый пароль" required>
            
            <label for="password">Новый пароль:</label>
            <input type="password" id="password" name="password" placeholder="Введите новый пароль" required>
            
            <label for="confirmed_password">Подтверждение нового пароля:</label>
            <input type="password" id="confirmed_password" name="confirmed_password" placeholder="Подтвердите новый пароль" required>
            
            <div class="button-container">
                <button type="submit">Сохранить изменения</button>
            </div>
        </form>
    </div>
</div>

</body>
</html>
